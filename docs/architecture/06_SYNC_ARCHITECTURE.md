# One By Two â€” Sync Architecture & Offline-First Design

> **Version:** 1.1  
> **Last Updated:** 2026-02-14

---

## 1. Offline-First Philosophy

The app must be **fully functional without internet**. Users should never be blocked from adding expenses, viewing balances, or recording settlements.

### Core Principles

1. **Local DB (sqflite) is the UI's source of truth** â€” all reads come from local DB
2. **Write-local-first** â€” all mutations save locally before syncing
3. **Background sync** â€” Firestore sync happens asynchronously
4. **Conflict resolution** â€” deterministic rules for handling concurrent edits
5. **Transparent status** â€” user always knows sync state (âœ“ synced, â†‘ pending, âš  conflict)

---

## 2. Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SYNC ARCHITECTURE                             â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     UI       â”‚â”€â”€â”€â”€>â”‚  Repository  â”‚â”€â”€â”€â”€>â”‚  Local sqflite   â”‚ â”‚
â”‚  â”‚  (Riverpod)  â”‚     â”‚  (write)     â”‚     â”‚  (immediate save)â”‚ â”‚
â”‚  â”‚              â”‚<â”€â”€â”€â”€â”‚              â”‚     â”‚                  â”‚ â”‚
â”‚  â”‚              â”‚     â”‚              â”‚     â”‚  sync_status =   â”‚ â”‚
â”‚  â”‚              â”‚     â”‚              â”‚     â”‚  'pending'       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                      â”‚            â”‚
â”‚                              â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                              â”‚              â”‚   Sync Queue     â”‚ â”‚
â”‚                              â”‚              â”‚   (sync_queue    â”‚ â”‚
â”‚                              â”‚              â”‚    table)        â”‚ â”‚
â”‚                              â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                      â”‚            â”‚
â”‚                              â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                              â”‚              â”‚   Sync Engine    â”‚ â”‚
â”‚                              â”‚              â”‚                  â”‚ â”‚
â”‚                              â”‚              â”‚ â€¢ Watches queue  â”‚ â”‚
â”‚                              â”‚              â”‚ â€¢ Watches networkâ”‚ â”‚
â”‚                              â”‚              â”‚ â€¢ Processes ops  â”‚ â”‚
â”‚                              â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                      â”‚            â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚                   NETWORK BOUNDARY                  â”‚            â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚                              â”‚                      â”‚            â”‚
â”‚                              â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                              â”‚              â”‚   Firestore      â”‚ â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   (cloud DB)     â”‚ â”‚
â”‚                                             â”‚                  â”‚ â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â€¢ Real-time      â”‚ â”‚
â”‚                        â”‚                    â”‚   listeners      â”‚ â”‚
â”‚                        â”‚                    â”‚ â€¢ Offline cache  â”‚ â”‚
â”‚                        â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                        â”‚                                         â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                â”‚  Firestore       â”‚                              â”‚
â”‚                â”‚  Listener        â”‚                              â”‚
â”‚                â”‚  Handler         â”‚                              â”‚
â”‚                â”‚                  â”‚                              â”‚
â”‚                â”‚  On remote       â”‚                              â”‚
â”‚                â”‚  change:         â”‚                              â”‚
â”‚                â”‚  â€¢ Update local  â”‚                              â”‚
â”‚                â”‚    sqflite       â”‚                              â”‚
â”‚                â”‚  â€¢ Notify UI     â”‚                              â”‚
â”‚                â”‚    via Stream    â”‚                              â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Write Flow (Offline-Safe)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WRITE FLOW (e.g., Add Expense)                â”‚
â”‚                                                                  â”‚
â”‚  User taps "Save"                                                â”‚
â”‚       â”‚                                                          â”‚
â”‚       â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ 1. VALIDATE                             â”‚                    â”‚
â”‚  â”‚    - Amount > 0                         â”‚                    â”‚
â”‚  â”‚    - At least one payer                 â”‚                    â”‚
â”‚  â”‚    - At least one participant           â”‚                    â”‚
â”‚  â”‚    - Splits sum equals amount           â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                 â”‚                                                â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚       â”‚ 2. GENERATE ID    â”‚  UUID v4 on device                  â”‚
â”‚       â”‚    SET version = 1â”‚                                     â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                 â”‚                                                â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚       â”‚ 3. SAVE TO LOCAL sqflite                   â”‚            â”‚
â”‚       â”‚    - expenses table (sync_status = pending)â”‚            â”‚
â”‚       â”‚    - expense_payers table                  â”‚            â”‚
â”‚       â”‚    - expense_splits table                  â”‚            â”‚
â”‚       â”‚    - expense_items table (if itemized)     â”‚            â”‚
â”‚       â”‚    Transaction: all-or-nothing             â”‚            â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                 â”‚                                                â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚       â”‚ 4. RECALCULATE LOCAL BALANCES              â”‚            â”‚
â”‚       â”‚    GROUP: Update group_balances table      â”‚            â”‚
â”‚       â”‚           Update groups.my_balance         â”‚            â”‚
â”‚       â”‚    FRIEND: Update friends.balance           â”‚            â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                 â”‚                                                â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚       â”‚ 5. LOG ACTIVITY LOCALLY                    â”‚            â”‚
â”‚       â”‚    - Insert into activity_log table         â”‚            â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                 â”‚                                                â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚       â”‚ 6. ENQUEUE SYNC OPERATION                  â”‚            â”‚
â”‚       â”‚    sync_queue.insert({                      â”‚            â”‚
â”‚       â”‚      entity_type: 'expense',                â”‚            â”‚
â”‚       â”‚      entity_id: expense.id,                 â”‚            â”‚
â”‚       â”‚      operation: 'create',                   â”‚            â”‚
â”‚       â”‚      payload_json: serializedExpense,        â”‚            â”‚
â”‚       â”‚      context_type: 'group' | 'friend',      â”‚            â”‚
â”‚       â”‚      context_id: groupId | friendPairId,    â”‚            â”‚
â”‚       â”‚      status: 'pending'                      â”‚            â”‚
â”‚       â”‚    })                                       â”‚            â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                 â”‚                                                â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚       â”‚ 7. RETURN SUCCESS TO UI (< 500ms)          â”‚            â”‚
â”‚       â”‚    - Show expense in list                   â”‚            â”‚
â”‚       â”‚    - Show "â†‘ pending" sync badge            â”‚            â”‚
â”‚       â”‚    - Show undo snackbar (30s)               â”‚            â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                 â”‚                                                â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚       â”‚ 8. SYNC ENGINE (async, non-blocking)       â”‚            â”‚
â”‚       â”‚    IF online:                               â”‚            â”‚
â”‚       â”‚      - Process sync queue                   â”‚            â”‚
â”‚       â”‚      - Write to Firestore                   â”‚            â”‚
â”‚       â”‚      - On success: sync_status = 'synced'   â”‚            â”‚
â”‚       â”‚      - On failure: retry with backoff        â”‚            â”‚
â”‚       â”‚    ELSE:                                    â”‚            â”‚
â”‚       â”‚      - Queue remains pending                â”‚            â”‚
â”‚       â”‚      - Processed when connectivity returns  â”‚            â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Read Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    READ FLOW                                     â”‚
â”‚                                                                  â”‚
â”‚  UI requests data (e.g., group or friend expenses)              â”‚
â”‚       â”‚                                                          â”‚
â”‚       â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Repository.getExpenses(groupId) OR               â”‚            â”‚
â”‚  â”‚ Repository.getFriendExpenses(friendPairId)       â”‚            â”‚
â”‚  â”‚                                                  â”‚            â”‚
â”‚  â”‚ Returns: Stream<List<Expense>>                   â”‚            â”‚
â”‚  â”‚                                                  â”‚            â”‚
â”‚  â”‚ Source: LOCAL sqflite only                        â”‚            â”‚
â”‚  â”‚         (never waits for network)                â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                 â”‚                                                â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚       â”‚ Concurrent: Firestore Real-Time Listener    â”‚            â”‚
â”‚       â”‚                                             â”‚            â”‚
â”‚       â”‚ GROUP:                                      â”‚            â”‚
â”‚       â”‚ firestore.collection('groups/$gid/expenses')â”‚            â”‚
â”‚       â”‚   .where('isDeleted', isEqualTo: false)     â”‚            â”‚
â”‚       â”‚   .orderBy('date', descending: true)        â”‚            â”‚
â”‚       â”‚   .snapshots()                              â”‚            â”‚
â”‚       â”‚                                             â”‚            â”‚
â”‚       â”‚ FRIEND:                                     â”‚            â”‚
â”‚       â”‚ firestore.collection('friends/$fid/expenses')â”‚           â”‚
â”‚       â”‚   .where('isDeleted', isEqualTo: false)     â”‚            â”‚
â”‚       â”‚   .orderBy('date', descending: true)        â”‚            â”‚
â”‚       â”‚   .snapshots()                              â”‚            â”‚
â”‚       â”‚                                             â”‚            â”‚
â”‚       â”‚   .listen((snapshot) {                      â”‚            â”‚
â”‚       â”‚     for each changed doc:                   â”‚            â”‚
â”‚       â”‚       upsert into local sqflite             â”‚            â”‚
â”‚       â”‚       // This triggers Stream re-emission   â”‚            â”‚
â”‚       â”‚   })                                        â”‚            â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                  â”‚
â”‚  Result:                                                         â”‚
â”‚  â€¢ Instant display from local data (even offline)               â”‚
â”‚  â€¢ Live updates when Firestore pushes changes                   â”‚
â”‚  â€¢ UI always reflects latest local state                        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Sync Engine Details

### 5.1 Sync Queue Processing

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                SYNC QUEUE PROCESSOR                              â”‚
â”‚                                                                  â”‚
â”‚  Triggers:                                                       â”‚
â”‚  â€¢ App comes online (connectivity change)                       â”‚
â”‚  â€¢ New item enqueued while online                               â”‚
â”‚  â€¢ Manual sync button pressed                                   â”‚
â”‚  â€¢ App returns to foreground                                    â”‚
â”‚                                                                  â”‚
â”‚  Processing Loop:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  1. Query: SELECT * FROM sync_queue                      â”‚   â”‚
â”‚  â”‚           WHERE status = 'pending'                       â”‚   â”‚
â”‚  â”‚           ORDER BY created_at ASC                        â”‚   â”‚
â”‚  â”‚           LIMIT 10                                       â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  2. For each operation:                                  â”‚   â”‚
â”‚  â”‚     a. Mark status = 'in_progress'                       â”‚   â”‚
â”‚  â”‚     b. Execute Firestore write                           â”‚   â”‚
â”‚  â”‚     c. On SUCCESS:                                       â”‚   â”‚
â”‚  â”‚        - Mark status = 'completed'                       â”‚   â”‚
â”‚  â”‚        - Update entity sync_status = 'synced'            â”‚   â”‚
â”‚  â”‚        - Delete from sync_queue                          â”‚   â”‚
â”‚  â”‚     d. On FAILURE:                                       â”‚   â”‚
â”‚  â”‚        - Increment retry_count                           â”‚   â”‚
â”‚  â”‚        - If retry_count < max_retries:                   â”‚   â”‚
â”‚  â”‚          Mark status = 'pending'                         â”‚   â”‚
â”‚  â”‚          Apply exponential backoff                       â”‚   â”‚
â”‚  â”‚        - If retry_count >= max_retries:                  â”‚   â”‚
â”‚  â”‚          Mark status = 'failed'                          â”‚   â”‚
â”‚  â”‚          Mark entity sync_status = 'conflict'            â”‚   â”‚
â”‚  â”‚          Notify user                                     â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  3. Repeat until queue empty or offline                  â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  Backoff schedule:                                               â”‚
â”‚  Retry 1: 2s | Retry 2: 4s | Retry 3: 8s |                     â”‚
â”‚  Retry 4: 16s | Retry 5: 32s (max)                             â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Conflict Resolution Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               CONFLICT RESOLUTION                                â”‚
â”‚                                                                  â”‚
â”‚  Scenario: Two users edit same expense offline                  â”‚
â”‚                                                                  â”‚
â”‚  Detection:                                                      â”‚
â”‚  â€¢ Each expense has a `version` field (integer, incremented on  â”‚
â”‚    every edit)                                                   â”‚
â”‚  â€¢ When pushing to Firestore, Cloud Function checks:            â”‚
â”‚    IF doc.version != expected_version â†’ CONFLICT                â”‚
â”‚                                                                  â”‚
â”‚  Resolution Rules:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  RULE 1: Delete always wins                              â”‚   â”‚
â”‚  â”‚  If one party deleted and other edited â†’ delete wins     â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  RULE 2: Last-write-wins for non-critical fields         â”‚   â”‚
â”‚  â”‚  Fields: description, notes, category, date              â”‚   â”‚
â”‚  â”‚  Resolution: Server timestamp determines winner          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  RULE 3: User-prompted for critical fields               â”‚   â”‚
â”‚  â”‚  Fields: amount, payers, splits                          â”‚   â”‚
â”‚  â”‚  Resolution:                                             â”‚   â”‚
â”‚  â”‚  â€¢ Mark expense sync_status = 'conflict'                 â”‚   â”‚
â”‚  â”‚  â€¢ Show âš  badge on expense in UI                        â”‚   â”‚
â”‚  â”‚  â€¢ User taps â†’ sees both versions side-by-side           â”‚   â”‚
â”‚  â”‚  â€¢ User picks which version to keep                      â”‚   â”‚
â”‚  â”‚  â€¢ Resolved version pushed with incremented version      â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  RULE 4: Additive operations don't conflict              â”‚   â”‚
â”‚  â”‚  New expense, new settlement â†’ always succeeds           â”‚   â”‚
â”‚  â”‚  (unique IDs prevent collision)                          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  Conflict UI:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  âš  Conflict: "Lunch at Beach Shack"                     â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Your version:              Server version:              â”‚   â”‚
â”‚  â”‚  Amount: â‚¹2,400             Amount: â‚¹2,800              â”‚   â”‚
â”‚  â”‚  Split: 4 people            Split: 5 people              â”‚   â”‚
â”‚  â”‚  Modified: 2 min ago        Modified: 1 min ago          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  [Keep Mine]    [Keep Theirs]    [Edit & Merge]          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Firestore Listener Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FIRESTORE LISTENER LIFECYCLE                        â”‚
â”‚                                                                  â”‚
â”‚  Listeners are registered per-screen to minimize read costs:    â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Screen               â”‚ Active Listeners                  â”‚   â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚ Home                 â”‚ userGroups/{uid}/groups            â”‚   â”‚
â”‚  â”‚                      â”‚ userFriends/{uid}/friends          â”‚   â”‚
â”‚  â”‚                      â”‚ users/{uid}/notifications          â”‚   â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚ Group Detail         â”‚ groups/{gid}/expenses              â”‚   â”‚
â”‚  â”‚                      â”‚ groups/{gid}/balances              â”‚   â”‚
â”‚  â”‚                      â”‚ groups/{gid}/members               â”‚   â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚ Friend Detail        â”‚ friends/{fid}/expenses             â”‚   â”‚
â”‚  â”‚                      â”‚ friends/{fid}/balance              â”‚   â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚ Activity Feed        â”‚ groups/{gid}/activity              â”‚   â”‚
â”‚  â”‚                      â”‚ friends/{fid}/activity             â”‚   â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚ Settle Up (Group)    â”‚ groups/{gid}/balances              â”‚   â”‚
â”‚  â”‚                      â”‚ groups/{gid}/settlements           â”‚   â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚ Settle Up (Friend)   â”‚ friends/{fid}/balance              â”‚   â”‚
â”‚  â”‚                      â”‚ friends/{fid}/settlements          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  Lifecycle:                                                      â”‚
â”‚  â€¢ Listener started when screen is opened (via Riverpod)        â”‚
â”‚  â€¢ Listener disposed when screen is popped                      â”‚
â”‚  â€¢ Riverpod autoDispose ensures no memory leaks                 â”‚
â”‚  â€¢ Each listener updates local sqflite â†’ triggers UI Stream     â”‚
â”‚                                                                  â”‚
â”‚  Cost optimization:                                              â”‚
â”‚  â€¢ Listen to changed docs only (Firestore diff)                 â”‚
â”‚  â€¢ Use field masks where possible                               â”‚
â”‚  â€¢ Pagination for large collections (expenses)                  â”‚
â”‚  â€¢ Debounce rapid changes (200ms window)                        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Sync Status Indicators

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SYNC STATUS UI                                      â”‚
â”‚                                                                  â”‚
â”‚  Status Badge (shown on each expense/settlement card):          â”‚
â”‚                                                                  â”‚
â”‚  âœ“  Synced     â€” Green checkmark, subtle                       â”‚
â”‚  â†‘  Pending    â€” Blue upload arrow, pulsing                    â”‚
â”‚  âš   Conflict   â€” Orange warning, requires user action          â”‚
â”‚  âœ•  Failed     â€” Red X, tap to retry                           â”‚
â”‚                                                                  â”‚
â”‚  Global Sync Bar (top of screen, shown when syncing):           â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â†‘ Syncing 3 changes...                    [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 60% â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  Offline Banner (shown when no internet):                       â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“µ You're offline. Changes will sync when connected.    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Data Flow Diagram (Complete)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     COMPLETE DATA FLOW                                â”‚
â”‚                                                                      â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                        â”‚    UI     â”‚                                 â”‚
â”‚                        â”‚ (Flutter) â”‚                                 â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                     reads â†‘  â”‚ writes                                â”‚
â”‚                              â”‚                                       â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                     â”‚    Riverpod     â”‚                              â”‚
â”‚                     â”‚   Providers     â”‚                              â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                              â”‚                                       â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                     â”‚   Use Cases     â”‚                              â”‚
â”‚                     â”‚   (Domain)      â”‚                              â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                              â”‚                                       â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                     â”‚  Repositories   â”‚                              â”‚
â”‚                     â”‚  (Data Layer)   â”‚                              â”‚
â”‚                     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜                              â”‚
â”‚                         â”‚         â”‚                                   â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚              â”‚  Local DAO  â”‚  â”‚  Firestore   â”‚                      â”‚
â”‚              â”‚  (sqflite)  â”‚  â”‚  Source       â”‚                      â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                     â”‚             â”‚                                   â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚         â”‚   sqflite    â”‚    â”‚  Sync Engine   â”‚                      â”‚
â”‚         â”‚   Database   â”‚    â”‚                â”‚                      â”‚
â”‚         â”‚              â”‚â—„â”€â”€â”€â”‚  Pull: FS â†’    â”‚                      â”‚
â”‚         â”‚  â€¢ expenses  â”‚    â”‚    Local DB    â”‚                      â”‚
â”‚         â”‚  â€¢ groups    â”‚    â”‚                â”‚                      â”‚
â”‚         â”‚  â€¢ balances  â”‚    â”‚  Push: Queue â†’ â”‚                      â”‚
â”‚         â”‚  â€¢ sync_queueâ”‚â”€â”€â”€â–ºâ”‚    Firestore   â”‚                      â”‚
â”‚         â”‚              â”‚    â”‚                â”‚                      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                  â”‚                                   â”‚
â”‚           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                    â”‚
â”‚                                  â”‚                                   â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                          â”‚  Cloud Firestore  â”‚                      â”‚
â”‚                          â”‚  (asia-south1)    â”‚                      â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                  â”‚                                   â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                          â”‚ Cloud Functions   â”‚                      â”‚
â”‚                          â”‚ â€¢ Recalc balances â”‚                      â”‚
â”‚                          â”‚ â€¢ Send push notif â”‚                      â”‚
â”‚                          â”‚ â€¢ Activity log    â”‚                      â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
